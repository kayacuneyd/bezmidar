import{w as s,g as c}from"./iHlYtNcj.js";const u=globalThis.__sveltekit_o67evz.env,d="https://api.dijitalmentor.de/server/api",m=(u.PUBLIC_API_URL||d).replace(/\/$/,"");function g(){const{subscribe:i,set:a}=s({user:null,token:null,isAuthenticated:!1,loading:!0});return{subscribe:i,checkAuth:async()=>{const e=localStorage.getItem("dijitalmentor_token"),o=localStorage.getItem("dijitalmentor_user"),n=o?JSON.parse(o):null,r=t=>{localStorage.setItem("dijitalmentor_token",e),localStorage.setItem("dijitalmentor_user",JSON.stringify(t)),a({user:t,token:e,isAuthenticated:!0,loading:!1})};if(!e){a({user:null,token:null,isAuthenticated:!1,loading:!1});return}try{const t=await fetch(`${m}/auth/me.php`,{headers:{Authorization:`Bearer ${e}`}}),l=await t.json();if(t.ok&&(l!=null&&l.data)){r(l.data);return}}catch(t){console.warn("Auth sync failed",t)}if(n){r(n);return}localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1})},login:(e,o)=>{localStorage.setItem("dijitalmentor_token",o),localStorage.setItem("dijitalmentor_user",JSON.stringify(e)),a({user:e,token:o,isAuthenticated:!0,loading:!1})},logout:()=>{localStorage.removeItem("dijitalmentor_token"),localStorage.removeItem("dijitalmentor_user"),a({user:null,token:null,isAuthenticated:!1,loading:!1}),c("/")}}}const f=g();export{f as a,u as e};
